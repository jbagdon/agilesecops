<!DOCTYPE html>
<html>
<head>
  <meta charset="utf-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <!-- The above 3 meta tags *must* come first in the head; any other head content must come *after* these tags -->
    <title>Blog</title>

    <!-- Site metadata description -->
    <meta name="description" content="How to create a vpn in roughly 5 minutes using a VPS and OpenVPN.">
    <meta name="keywords" content="OWASP, Puppet, SaltStack, Ansible, Python Fabric, penetration testing, vulnerability testing, phishing, static code analysis, automation, DevOps, CISO, Chief Information Officer as a Service, Cloud Security Alliance, CSA, self assessment, STAR, administration, NIST 800-53, ISO 27001, malware, governance, risk, compliance, pci, fireeye, security, threat, byod, mdm, mobile device management, Identity theft, Federal and/or civil liability, Exorbitant fines or lawsuits, Irreparable damage to an organizationâ€™s reputation, Loss in consumer confidence, Amazon Web Services"/>

    <!-- favicon code -->
    <link rel="icon" type="image/x-icon" href="images/favicon.png"/>

    <!-- Open Graph data -->
    <meta property="og:title" content="Create an OpenVPN Server in 5 Minutes" />
    <meta property="og:url" content="https://www.agilesecops.com/5-minute-vpn.html" />
    <meta property="og:image" content="https://www.agilesecops.com/images/vpn.png" />
    <meta property="og:description" content="How to create your own openvpn server within 5 minutes." />

    <script src="https://code.jquery.com/jquery-3.3.1.slim.min.js"></script>

<!-- Latest compiled and minified CSS -->
<link rel="stylesheet" href="https://maxcdn.bootstrapcdn.com/bootstrap/3.3.7/css/bootstrap.min.css">
</head>
<body>

<nav class="navbar navbar-default navbar-fixed-top" style="background-color: #fff;">
  <div class="container-fluid">
    <!-- Brand and toggle get grouped for better mobile display -->
    <div class="navbar-header">
      <button type="button" class="navbar-toggle collapsed" data-toggle="collapse" data-target="#navbar" aria-expanded="false">
        <span class="sr-only">Toggle navigation</span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
      </button>
      <a class="navbar-brand" href="index.html">AgileSecOps</a>
    </div>

    <!-- Collect the nav links, forms, and other content for toggling -->
    <div class="collapse navbar-collapse" id="navbar">
      <ul class="nav navbar-nav">
        <li><a href="Cyber-Security-Solutions.html">Services</a></li>
        <li><a href="by-industry.html">By Industry</a></li>
        <li><a href="contact.html">Contact</a></li>
        <li><a href="about.html">About</a></li>
        <li><a href="qualifications.html">Qualifications</a></li>
        <li class="dropdown">
          <a href="#" class="dropdown-toggle" data-toggle="dropdown" role="button" aria-haspopup="true" aria-expanded="false">Blog <span class="caret"></span></a>
          <ul class="dropdown-menu">
            <li><a href="blog.html">Current Blog</a></li>
            <li role="separator" class="divider"></li>
                <li><a href="2018-march.html">Mar-2018</a></li>
                <li><a href="2017-sep.html">Sep-2017</a></li>
                <li><a href="2017-aug.html">Aug-2017</a></li>
                <li><a href="2017-july.html">July-2017</a></li>
                <li><a href="2017-may.html">May-2017</a></li>
              <li><a href="2017-april.html">April-2017</a></li>
        </ul>
          </li>
        </ul><!-- /.navbar-collapse -->
  </div><!-- /.container-fluid -->
    </div>
    </nav>
<div id="openvpn" class="container-fluid" style="padding:50px 40px;">
      <h1>Create an OpenVPN Server in 5 Minutes</h1>
      <p>April 28, 2017</p>
      <div class="col-sm-12">
          <img src="images/vpn.png" alt="openvpn" class="center-block img-responsive" style="padding:40px 40px;">
          <p>Security and privacy are very important and there have been several blog posts out there talking about the importance of a VPN. I thought I would put together something to automate the creation of an OpenVPN server and the first client configuration.</p>
          <p>I'm using Python Fabric to do all the work and the install is based on a current version of Ubuntu. So, you could use this internally in order to get into your business or home environment or spin up a cloud instance at a place like Digital Ocean and secure all of your outbound traffic from the soon to be eyes of your ISP.</p>
          <p>All of the code and files are up on GitHub <a href="https://github.com/jbagdon/openvpn">here</a></p>
          <p>A quick peek at the Fabric script:</p>
          <pre>from fabric.api import *
from fabric.contrib.files import sed

def deploy_openvpn():
    sudo('apt-get update')
    sudo('apt-get -y install openvpn easy-rsa')
    run('make-cadir ~/openvpn-ca')
    put('vars', '~/openvpn-ca/vars', mode=0644)
    with cd('~/openvpn-ca'):
        with prefix('source vars'):
            run('./clean-all')
            run('./build-ca')
            run('./build-key-server server')
            run('./build-dh')
            run('openvpn --genkey --secret keys/ta.key')
            run('./build-key client1')
    with cd('~/openvpn-ca/keys'):
        sudo('cp ca.crt ca.key server.crt server.key ta.key dh2048.pem /etc/openvpn')
    put('server.conf', '/etc/openvpn/server.conf', mode=0644, use_sudo=True)
    sed('/etc/sysctl.conf', '#net.ipv4.ip_forward=1', 'net.ipv4.ip_forward=1', use_sudo=True)
    sudo('sysctl -p')
    put('before.rules', '/etc/ufw/before.rules', mode=0640, use_sudo=True)
    sed('/etc/default/ufw', 'DEFAULT_FORWARD_POLICY=.*', 'DEFAULT_FORWARD_POLICY="ACCEPT"', use_sudo=True)
    sudo('ufw allow 1194/udp')
    sudo('ufw allow OpenSSH')
    sudo('ufw disable')
    sudo('ufw enable')
    sudo('systemctl enable openvpn@server')
    sudo('systemctl start openvpn@server')
    run('mkdir -p ~/client-configs/files')
    run('chmod 700 ~/client-configs/files')
    put('base.conf', '~/client-configs', mode=0644)
    put('make_config.sh','~/client-configs', mode=0700)
    with cd('~/client-configs'):
        run('./make_config.sh client1')</pre>

          <p>You will first have to change a couple of settings. In the vars file, there is a section that sets the settings for the certificate, change these to match your name and email if you want. The other item that is rather important is in the base.conf file you need to change the server IP. This is the file that the OpenVPN config file is generated from and you'll want to connect to the correct IP.</p>
          <p>Then just run the Fabric script:</p>

          <pre>fab -H 172.16.0.4 -u root -i ~/.ssh/id_rsa deploy_openvpn</pre>

          <p>The -H option is the IP address of the destination server that you are deploying to.</p>
          <p>The -u is the username that you are logging in with.</p>
          <p>The -i is the ssh key that you are using to login with.</p>
          <p>And, the deploy_openvpn is the name of the function within the Fabric script that you are deploying.</p>
          <p>Don't go too quickly and read the prompts. There will be a few critical prompts to answer yes to or it will not work.

          <p>After it has ran you should end up with a client config file located in your user directory at ~/client-configs/files/client1.ovpn</p>

          <p>Download the client config and import it into your favorite VPN client. Connect and surf securely</p>
      </div>
    </div>
<!-- Bootstrap core JavaScript
================================================== -->
<!-- Latest compiled and minified JavaScript -->
<script src="https://maxcdn.bootstrapcdn.com/bootstrap/3.3.7/js/bootstrap.min.js" async></script>
</body>
</html>
